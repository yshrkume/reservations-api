# Sushi Reservation System - Deployment Guide

This guide explains how to deploy the Sushi Reservation System using Railway (backend) and Vercel (frontend).

## Architecture Overview

- **Frontend**: Next.js app deployed on Vercel
- **Backend**: Node.js/Express API deployed on Railway
- **Database**: PostgreSQL on Railway

## Prerequisites

1. GitHub repository: https://github.com/yshrkume/sushi-reservation
2. Railway account: https://railway.app
3. Vercel account: https://vercel.com

## Part 1: Deploy Backend API to Railway

### 1. Create Railway Project

1. Go to https://railway.app and sign in
2. Click "New Project"
3. Select "Deploy from GitHub repo"
4. Connect your GitHub account and select `yshrkume/sushi-reservation`
5. Railway will detect the API and Web app - select the API folder

### 2. Configure Environment Variables

In your Railway project dashboard, go to Variables and add:

```
NODE_ENV=production
ADMIN_PASSWORD=your-secure-admin-password
DATABASE_URL=[Railway will auto-generate this when you add PostgreSQL]
```

### 3. Add PostgreSQL Database

1. In your Railway project, click "New Service"
2. Select "Database" â†’ "PostgreSQL"
3. Railway will automatically set the `DATABASE_URL` environment variable

### 4. Configure Build Settings

Railway should automatically detect the configuration from `nixpacks.toml`, but verify:

```toml
[phases.setup]
nixPkgs = ['nodejs_18', 'npm-9_x']

[phases.install]
cmds = ['npm ci']

[phases.build]
cmds = ['npx prisma generate', 'npx prisma migrate deploy']

[start]
cmd = 'npm start'
```

### 5. Deploy

1. Railway will automatically deploy when you push to your main branch
2. Note the generated Railway URL (e.g., `https://your-app.railway.app`)

## Part 2: Deploy Frontend to Vercel

### 1. Connect Repository

1. Go to https://vercel.com and sign in
2. Click "New Project"
3. Import your GitHub repository: `yshrkume/sushi-reservation`
4. Select the `reservations-web/my-app` folder as the project root

### 2. Configure Build Settings

Vercel should auto-detect Next.js, but verify:

- **Framework Preset**: Next.js
- **Root Directory**: `reservations-web/my-app`
- **Build Command**: `npm run build`
- **Output Directory**: `.next`

### 3. Environment Variables

In Vercel project settings, add:

```
NEXT_PUBLIC_API_URL=https://your-railway-app.railway.app
```

Replace `your-railway-app.railway.app` with your actual Railway API URL.

### 4. Deploy

1. Click "Deploy"
2. Vercel will build and deploy your frontend
3. Note the generated Vercel URL (e.g., `https://your-app.vercel.app`)

## Part 3: Verification

### Test the Deployment

1. **Frontend**: Visit your Vercel URL
2. **API Health**: Visit `https://your-railway-app.railway.app/health`
3. **Database**: Check that the calendar loads with available time slots
4. **Admin**: Test admin login with your configured password

### Common Issues

1. **Database Connection**: Ensure Railway PostgreSQL is running and `DATABASE_URL` is set
2. **CORS**: API should allow requests from your Vercel domain
3. **Environment Variables**: Double-check that `NEXT_PUBLIC_API_URL` points to your Railway API

## Part 4: Custom Domain (Optional)

### Vercel Custom Domain

1. In Vercel project settings, go to "Domains"
2. Add your custom domain
3. Configure DNS as instructed by Vercel

### Railway Custom Domain

1. In Railway project settings, go to "Domains"
2. Add your custom domain
3. Configure DNS as instructed by Railway
4. Update `NEXT_PUBLIC_API_URL` in Vercel to use your custom API domain

## Environment Configuration Summary

### Railway (Backend)
```
NODE_ENV=production
ADMIN_PASSWORD=your-secure-password
DATABASE_URL=[auto-generated by Railway PostgreSQL]
```

### Vercel (Frontend)
```
NEXT_PUBLIC_API_URL=https://your-railway-app.railway.app
```

## Monitoring and Maintenance

1. **Railway**: Monitor logs and metrics in Railway dashboard
2. **Vercel**: Monitor deployments and analytics in Vercel dashboard
3. **Database**: Monitor PostgreSQL usage in Railway
4. **Updates**: Both platforms auto-deploy on git push to main branch

## Security Notes

1. Keep `ADMIN_PASSWORD` secure and unique
2. Railway provides HTTPS by default
3. Vercel provides HTTPS by default
4. Database is only accessible from Railway environment
5. API endpoints validate admin authentication

## Support

- Railway: https://docs.railway.app
- Vercel: https://vercel.com/docs
- Repository: https://github.com/yshrkume/sushi-reservation/issues